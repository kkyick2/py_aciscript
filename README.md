# APIC Data Extraction and Analysis

## Overview

This project provides a Python script (`pyapicapi.py`) to interact with Cisco APIC (Application Policy Infrastructure Controller) APIs, retrieve data, and export it to Excel files. It supports configurable data extraction based on JSON configuration files and includes optional analysis and contract parsing features through additional modules (`pyapicanaylsis_interface` and `pyapicanaylsis_contract`).

## Features

- **API Interaction**: Authenticates with APIC to retrieve data using provided credentials.
- **Configurable Data Extraction**: Uses JSON configuration files to specify data tables and properties to extract.
- **Data Processing**: Converts JSON responses to pandas DataFrames and exports them to Excel.
- **Logging**: Configurable logging for development and production environments.
- **Command-Line Interface**: Supports input file specification and analysis flags via command-line arguments.
- **Modular Design**: Integrates with analysis modules for extended functionality.

## Prerequisites

- Python 3.6+
- Required Python packages:
  - `pandas`
  - `requests`
  - `argparse`
  - `logging`
  - `json`
- Cisco APIC access with valid credentials.
- Configuration files in JSON format located in the `config` directory.
- (Optional) `pyapicanaylsis_interface` and `pyapicanaylsis_contract` modules for analysis features.

## Installation

1. Clone the repository or copy the script files to your local machine.
2. Install dependencies:
   ```bash
   pip install pandas requests
   ```
3. Ensure the `config`, `log`, and `src` directories exist as shown in the directory structure.
4. Place APIC configuration JSON files (e.g., `n1_apic.json`) in the `config` directory.

## Directory Structure

```plaintext
py_aciscript/
│
├── config/
│   ├── logging.dev.json
│   ├── logging.prod.json
│   ├── n1_apic.json
│   └── n2_apic.json
├── log/
│   └── (generated log files)
├── src/
│   ├── pyapicapi.py
│   ├── pyapicanaylsis_interface.py
│   ├── pyapicanaylsis_contract.py
└── README.md
```

## Usage

### pyapicapi.py

Get Cisco APIC information using REST API.

```sh
usage: pyapicapi.py [-h] [-i INFILES] [-a]

options:
  -h, --help            show this help message and exit
  -i INFILES, --infiles INFILES
                        input json in config folder, example: -i n1_input.json,n2_input.json,n3_input.json
  -a, --anaylsis        flag to analysis and parse table to new excel
```

1. Prepare `xxx_input.json` config file in the `config` folder.
2. **Option 1: Interactive File Selection**
   ```sh
   python src/pyapicapi.py
   ```
   - The script lists available JSON config files in the `config` directory and prompts the user to select one.
3. **Option 2: Specify Input Files via Command Line**
   ```sh
   python src/pyapicapi.py -i n1_apic.json,n2_apic.json,p1_apic.json,p2_apic.json -a
   ```
   - `-i` or `--infiles`: Comma-separated list of JSON config files in the `config` directory.
   - `-a` or `--anaylsis`: Enables additional analysis and contract parsing.

### pyapicanaylsis_contract.py, pyapicanaylsis_interface.py

Analyze tables generated by `pyapicapi.py`.

```sh
usage: pyapicanaylsis_interface.py [-h] [-i INFILES]

options:
  -h, --help            show this help message and exit
  -i INFILES, --infiles INFILES
                        input excel from pyapicapi.py, example: -i n1_20240101.xlsx
```

- These scripts process Excel files generated by `pyapicapi.py` for further analysis or contract parsing.
- Ensure the input Excel files are available in the `py_aciscript` root directory.

### Configuration File Format

The JSON configuration files (e.g., `n1_apic.json`) must follow this structure:

```json
{
  "login": {
    "username": "admin",
    "password": "passw0rd",
    "environment": "np1",
    "ip": "10.1.1.1:443",
    "remove_properties_flag": 1
  },
  "tables": [
    {
      "name": "Loading APIC Topology",
      "key": "topSystem",
      "alias": "Topology",
      "remove_properties": ["oobMgmtGateway", "configIssues"]
    }
  ]
}
```

- `login`: Contains APIC credentials and connection details.
- `tables`: List of tables to extract, including the API key, alias, and properties to remove.

### Output

- **Excel Files**: Generated in the `py_aciscript` root directory with names like `apic_np1_YYYYMMDD_HHMM.xlsx`.
- **Log Files**: Generated in the `log` directory with names like `pyapicapi_YYYYMMDD_HHMMSS.log`.

## Logging

- Logging is configured via `logging.dev.json` or `logging.prod.json` in the `config` directory.
- The environment (`LOG_ENV`) defaults to `dev` but can be set to `prod` for production logging.
- Logs are written to the `log` directory with timestamps.

## Security Notes

- The script disables SSL verification for API requests (`verify=False`). Use with caution in production environments.
- Ensure sensitive information (e.g., usernames, passwords) in config files is securely stored and access is restricted.

## Extending the Script

- **Analysis Modules**: The `-a` flag triggers additional processing via `pyapicanaylsis_interface` and `pyapicanaylsis_contract`. Ensure these modules are available in the `src` directory and correctly implemented.
- **Custom Configurations**: Modify JSON config files to extract different APIC data or adjust properties to remove.

## Troubleshooting

- **Missing Config Files**: Ensure JSON files are in the `config` directory and follow the required format.
- **API Errors**: Verify APIC IP, credentials, and network connectivity.
- **Logging Issues**: Check that `logging.dev.json` or `logging.prod.json` exists and is valid JSON.

## License

This project is provided as-is, with no warranty. Use and modify according to your organization's policies.
